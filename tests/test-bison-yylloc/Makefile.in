# Makefile.in for a single TEST.
#
# By default this Makefile will build the target "$(TESTNAME)"
# from the sources "scanner.l" and "parser.y".
#
# $(TESTNAME) is supplied by the calling Makefile.
# "parser.y"  is not necessary. You may delete this file
#             if you do not require a parser.
# "scanner.l" is necessary. It should build "scanner.c".
#

@SET_MAKE@

CFLAGS = @CFLAGS@
CPPFLAGS = @CPPFLAGS@ -I. -I"@srcdir@" -I..
DEFS = @DEFS@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@
SHELL = /bin/sh
srcdir = @srcdir@
VPATH = @srcdir@
LN_S = @LN_S@
YACC = @YACC@
CC = @CC@
AR = ar
RANLIB = @RANLIB@
YACC = @YACC@

# Edit these if necessary for your specific test.
FLEX = ../../flex
YFLAGS = --defines --output-file="parser.c" --name-prefix="test" 

# Force YACC to be bison (autoconf generates 'bison -y')
YACC = @BISON@

TESTNAME = test-bison-yylloc
all: $(TESTNAME)

$(TESTNAME): parser.y scanner.l 
	if test "$(YACC)" = "bison" ; then \
		$(FLEX) $(srcdir)/scanner.l ; \
		$(YACC) $(YFLAGS) $(srcdir)/parser.y ; \
		$(CC) $(CPPFLAGS) $(CFLAGS) -c scanner.c ; \
		$(CC) $(CPPFLAGS) $(CFLAGS) -c parser.c ; \
		$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/main.c ; \
		$(CC) $(CFLAGS) -o $(TESTNAME) scanner.o parser.o main.o $(LDFLAGS) $(LIBS) ; \
	fi

test: check

check: $(TESTNAME)
	if test "$(YACC)" = "bison" ; then \
        {./$(TESTNAME) <$(srcdir)/test.input | ./$(TESTNAME) | \
        diff $(srcdir)/test.input -  ;}; \
    else \
        echo "Test skipped because GNU bison was not detected by configure." ; \
        exit 2;\
    fi

clean:
	rm -f scanner.o scanner.c main.o parser.o parser.c  parser.h $(TESTNAME) yyheader.h


distclean: clean
	rm -f Makefile

